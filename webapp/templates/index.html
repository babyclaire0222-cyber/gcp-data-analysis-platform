<!DOCTYPE html>
<html>
<head>
    <title>Data Analysis Upload</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h1 { color: #333; }
        .flash-message { padding: 10px; margin-bottom: 15px; border-radius: 4px; }
        .flash-success { background-color: #d4edda; color: #155724; }
        .flash-error { background-color: #f8d7da; color: #721c24; }
        form { margin-bottom: 20px; }
        .section { margin-top: 30px; }
    </style>
</head>
<body>
    <h1>Upload File for Analysis</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-message flash-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- File Upload Form -->
    <form action="/" method="post" enctype="multipart/form-data">
        <input type="file" name="file" accept=".csv,.sql" required>
        <button type="submit">Upload & Create Table</button>
    </form>

    <div class="section">
        <h2>Manual BigQuery Download</h2>
        <form action="/download_bq" method="get" id="downloadForm">
            <input type="text" name="table" placeholder="Enter table name" required>
            <button type="submit">Download Latest Analysis</button>
        </form>
    </div>

    {% if table_name %}
    <!-- Hidden link for auto-download -->
    <a id="autoDownload" href="/download_bq?table={{ table_name }}" style="display:none;"></a>
    <script>
        // Auto-trigger the download after page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('autoDownload').click();
        });
    </script>
    {% endif %}
</body>
</html>

